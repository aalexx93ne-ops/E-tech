{% load static %}
<form id="filter-form"
      hx-get="{% url 'index:index' %}"
      hx-target="#catalog-products"
      hx-swap="innerHTML"
      hx-push-url="true"
      hx-trigger="change, submit"
      class="sidebar">

  <h3 class="sidebar-title">Цена</h3>
  <div class="price-filter">
    <input type="text" inputmode="decimal" name="price_from" placeholder="От 0"
           value="{{ price_from|default:'' }}" autocomplete="off"
           hx-trigger="keyup changed delay:600ms"
           hx-get="{% url 'index:index' %}"
           hx-target="#catalog-products"
           hx-swap="innerHTML"
           hx-push-url="true"
           hx-include="#filter-form">
    <span class="price-separator">—</span>
    <input type="text" inputmode="decimal" name="price_to" placeholder="До 999 999"
           value="{{ price_to|default:'' }}" autocomplete="off"
           hx-trigger="keyup changed delay:600ms"
           hx-get="{% url 'index:index' %}"
           hx-target="#catalog-products"
           hx-swap="innerHTML"
           hx-push-url="true"
           hx-include="#filter-form">
  </div>

  <h3 class="sidebar-title" id="brands-title">Бренды</h3>
  <ul class="sidebar-list collapsible" id="brands-list" aria-labelledby="brands-title">
    {% for brand in brands %}
    <li class="{% if forloop.counter > 5 %}hidden-item{% endif %}">
      <label>
        <input type="checkbox" name="brand" value="{{ brand.slug }}"
               {% if brand.slug in selected_brands %}checked{% endif %}>
        {{ brand.name }}
      </label>
    </li>
    {% empty %}
    <li>Бренды не найдены.</li>
    {% endfor %}
  </ul>
  {% if brands|length > 5 %}
  <button type="button" class="show-more-btn" onclick="toggleList('brands-list', this)">Показать все ({{ brands|length }})</button>
  {% endif %}

  <h3 class="sidebar-title" id="categories-title">Категории</h3>
  <ul class="sidebar-list collapsible" id="categories-list" aria-labelledby="categories-title">
    {% for category in categories %}
    <li class="{% if forloop.counter > 5 %}hidden-item{% endif %}">
      <label>
        <input type="checkbox" name="category" value="{{ category.slug }}"
               {% if category.slug in selected_categories %}checked{% endif %}>
        {{ category.name }}
      </label>
    </li>
    {% empty %}
    <li>Категории не найдены.</li>
    {% endfor %}
  </ul>
  {% if categories|length > 5 %}
  <button type="button" class="show-more-btn" onclick="toggleList('categories-list', this)">Показать все ({{ categories|length }})</button>
  {% endif %}

  <h3 class="sidebar-title" id="tags-title">Теги</h3>
  <ul class="sidebar-list collapsible" id="tags-list" aria-labelledby="tags-title">
    {% for tag in tags %}
    <li class="{% if forloop.counter > 5 %}hidden-item{% endif %}">
      <label>
        <input type="checkbox" name="tag" value="{{ tag.slug }}"
               {% if tag.slug in selected_tags %}checked{% endif %}>
        {{ tag.name }}
      </label>
    </li>
    {% empty %}
    <li>Теги не найдены.</li>
    {% endfor %}
  </ul>
  {% if tags|length > 5 %}
  <button type="button" class="show-more-btn" onclick="toggleList('tags-list', this)">Показать все ({{ tags|length }})</button>
  {% endif %}

  {% if spec_filters %}
  {% for spec_type in spec_filters %}
  <h3 class="sidebar-title" id="spec-{{ spec_type.slug }}-title">{{ spec_type.name }}</h3>
  <ul class="sidebar-list collapsible" id="spec-{{ spec_type.slug }}-list" aria-labelledby="spec-{{ spec_type.slug }}-title">
    {% for value in spec_type.values %}
    <li class="{% if forloop.counter > 5 %}hidden-item{% endif %}">
      <label>
        <input type="checkbox" name="spec_{{ spec_type.slug }}" value="{{ value }}"
               {% if value in spec_type.selected_values %}checked{% endif %}>
        {{ value }}
      </label>
    </li>
    {% endfor %}
  </ul>
  {% if spec_type.values|length > 5 %}
  <button type="button" class="show-more-btn" onclick="toggleList('spec-{{ spec_type.slug }}-list', this)">Показать все ({{ spec_type.values|length }})</button>
  {% endif %}
  {% endfor %}
  {% endif %}

  <h3 class="sidebar-title">Скидка</h3>
  <ul class="sidebar-list">
    <li>
      <label>
        <input type="checkbox" name="discount" value="1"
               {% if discount_only %}checked{% endif %}>
        Только со скидкой
      </label>
    </li>
  </ul>

  <h3 class="sidebar-title">Сортировка</h3>
  <select name="sort" class="sort-select"
          hx-get="{% url 'index:index' %}"
          hx-target="#catalog-products"
          hx-swap="innerHTML"
          hx-push-url="true"
          hx-include="#filter-form"
          hx-trigger="change">
    <option value=""         {% if current_sort == '' %}selected{% endif %}>По умолчанию</option>
    <option value="price_asc"  {% if current_sort == 'price_asc' %}selected{% endif %}>Цена: по возрастанию</option>
    <option value="price_desc" {% if current_sort == 'price_desc' %}selected{% endif %}>Цена: по убыванию</option>
    <option value="new"        {% if current_sort == 'new' %}selected{% endif %}>Сначала новые</option>
  </select>

  <button class="action-btn primary" type="submit">Применить</button>
</form>

<script src="{% static 'js/sidebar.js' %}"></script>
